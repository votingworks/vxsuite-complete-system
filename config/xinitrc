xset -dpms
xset s off
xset s noblank
xrdb ~/.Xresources

export VX_CONFIG_ROOT="/vx/config"
export VX_METADATA_ROOT="/vx/code"

# delay until X is started and configured
# this appears to fix the issue where, sometimes, the Elo touchscreen doesn't respond
(sleep 6 && bash /vx/code/run-kiosk-browser-forever-and-log.sh) &

# Elo screen, adjust orientation and corresponding touch coordinates
# xinput is not ready to be used until X has fully started, so we have to delay
ELO="Elo Touch ET1502L"
(sleep 4 && if xinput list | grep "$ELO" > /dev/null; then
     # this is very specific to using the Lenovo m70q tiny with sound out via HDMI
     pulseaudio --start
     pulseaudio --kill
     pactl load-module module-alsa-sink device=hw:0,8
     pactl set-default-sink 1

     # prevent suspending the module, otherwise the start of chimes gets clipped
     pactl unload-module module-suspend-on-idle

     xrandr -o right
     xinput set-prop "$ELO" 'Coordinate Transformation Matrix' 0 1 0 -1 0 1 0 0 1

     # we need a startup chime to activate the channel
     # delay because it appears the xrandr and xinput commands above turn off sound for a bit
     # (because of course they do)
     sleep 5 && aplay ~/chime.wav
fi) &

# brightness all the way
sudo brightnessctl s 100%

exec /usr/bin/openbox-session


